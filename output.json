{
  "ast": [
    "root",
    [
      "module",
      "std/macros",
      ["imports"],
      ["exports"],
      [
        ["export", "pub", ["parameters", ["&body"]]],
        ["export", "`", ["parameters", ["&body"]]],
        ["export", "let", ["parameters", ["&body"]]],
        ["export", "var", ["parameters", ["&body"]]],
        ["export", "';'", ["parameters", ["&body"]]],
        ["export", "lambda", ["parameters", ["&body"]]],
        ["export", "'=>'", ["parameters", ["&body"]]],
        [
          "lambda-expr",
          ["definitions"],
          [
            "block",
            [
              "concat",
              ["quote", "parameters"],
              [
                "map",
                ["slice", "definitions", 1],
                [
                  "lambda-expr",
                  ["expr"],
                  [
                    "block",
                    [
                      "define",
                      "param-identifier-index",
                      ["if", ["==", ["length", "expr"], 3], 1, 2]
                    ],
                    [
                      "define",
                      "param-identifier",
                      ["extract", "expr", "param-identifier-index"]
                    ],
                    [
                      "define",
                      "type",
                      ["extract", "expr", ["+", "param-identifier-index", 1]]
                    ],
                    ["quote", "$param-identifier", "$type"]
                  ]
                ]
              ]
            ]
          ]
        ],
        ["export", "fn", ["parameters", ["&body"]]],
        [
          "export",
          "def-wasm-operator",
          ["parameters", ["op", "wasm-fn", "arg-type", "return-type"]]
        ],
        ["export", "extern-fn", ["parameters", ["&body"]]],
        ["export", "type", ["parameters", ["&body"]]],
        ["export", "global", ["parameters", ["&body"]]]
      ]
    ],
    [
      "module",
      "std/memory",
      ["imports", ["std/macros", "***"]],
      ["exports"],
      [
        ["define-global", ["typed-parameter", "header-size", "i32"], 8],
        ["define-global", ["typed-parameter", "size-index", "i32"], 0],
        ["define-global", ["typed-parameter", "type-index", "i32"], 4],
        ["define-mut-global", ["typed-parameter", "stack-pointer", "i32"], 0],
        [
          "define-function",
          "alloc",
          ["parameters", ["size", "i32"]],
          ["variables", ["address", "i32"]],
          ["return-type", "i32"],
          [
            "block",
            ["ensure-space", "size"],
            [
              "define",
              ["typed-parameter", "address", "i32"],
              ["block", "stack-pointer"]
            ],
            [
              "=",
              "stack-pointer",
              ["+", ["+", "stack-pointer", "size"], "header-size"]
            ],
            "address"
          ]
        ],
        ["export", "alloc", ["parameters", ["size", "i32"]]],
        [
          "define-function",
          "copy",
          ["parameters", ["src", "i32"], ["dest", "i32"]],
          ["variables"],
          ["return-type", "void"],
          [
            "block",
            ["bnr", ["memory", "copy"], ["dest", "src", ["read-i32", "src", 0]]]
          ]
        ],
        ["export", "copy", ["parameters", ["src", "i32"], ["dest", "i32"]]],
        [
          "define-function",
          "size",
          ["parameters", ["address", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          [
            "block",
            ["bnr", ["i32", "load"], [["quote", 0], ["quote", 0], "size-index"]]
          ]
        ],
        ["export", "size", ["parameters", ["address", "i32"]]],
        [
          "define-function",
          "set-return",
          ["parameters", ["return-address", "i32"]],
          ["variables", ["size", "i32"]],
          ["return-type", "i32"],
          [
            "block",
            [
              "define",
              ["typed-parameter", "size", "i32"],
              [
                "bnr",
                ["i32", "load"],
                [["quote", 0], ["quote", 0], "return-address"]
              ]
            ],
            ["=", "stack-pointer", ["+", "return-address", "size"]],
            "return-address"
          ]
        ],
        ["export", "set-return", ["parameters", ["return-address", "i32"]]],
        [
          "define-function",
          "read-i32",
          ["parameters", ["address", "i32"], ["offset", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          [
            "block",
            [
              "bnr",
              ["i32", "load"],
              [
                ["quote", 0],
                ["quote", 0],
                ["+", ["+", "address", "offset"], "header-size"]
              ]
            ]
          ]
        ],
        [
          "export",
          "read-i32",
          ["parameters", ["address", "i32"], ["offset", "i32"]]
        ],
        [
          "define-function",
          "store-i32",
          [
            "parameters",
            ["address", "i32"],
            ["offset", "i32"],
            ["value", "i32"]
          ],
          ["variables"],
          ["return-type", "void"],
          [
            "block",
            [
              "bnr",
              ["i32", "store"],
              [
                ["quote", 0],
                ["quote", 0],
                ["+", ["+", "address", "offset"], "header-size"],
                "value"
              ]
            ]
          ]
        ],
        [
          "export",
          "store-i32",
          [
            "parameters",
            ["address", "i32"],
            ["offset", "i32"],
            ["value", "i32"]
          ]
        ],
        [
          "define-function",
          "ensure-space",
          ["parameters", ["size", "i32"]],
          ["variables", ["mem-size", "i32"]],
          ["return-type", "i32"],
          [
            "block",
            [
              "define",
              ["typed-parameter", "mem-size", "i32"],
              ["bnr", ["memory", "size"]]
            ],
            [
              "if",
              [
                ">=",
                ["+", ["+", "stack-pointer", "size"], "header-size"],
                ["*", "mem-size", 65536]
              ],
              ["bnr", ["memory", "grow"], [1]],
              0
            ]
          ]
        ]
      ]
    ],
    [
      "module",
      "std/string",
      ["imports", ["std/macros", "***"]],
      ["exports"],
      [
        ["define-type", "String", "i32"],
        [
          "define-extern-function",
          "alloc-string",
          ["namespace", "strings"],
          ["parameters"],
          ["return-type", "String"]
        ],
        [
          "define-extern-function",
          "de-alloc-string",
          ["namespace", "strings"],
          ["parameters", ["str", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-len",
          ["namespace", "strings"],
          ["parameters", ["str", "String"]],
          ["return-type", "i32"]
        ],
        [
          "define-extern-function",
          "get-char-code-from-string",
          ["namespace", "strings"],
          ["parameters", ["charIndex", "i32"], ["str", "String"]],
          ["return-type", "i32"]
        ],
        [
          "define-extern-function",
          "add-char-code-to-string",
          ["namespace", "strings"],
          ["parameters", ["char", "i32"], ["str", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "print-str",
          ["namespace", "strings"],
          ["parameters", ["str", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-equals",
          ["namespace", "strings"],
          ["parameters", ["a", "String"], ["b", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-starts-with",
          ["namespace", "strings"],
          ["parameters", ["str", "String"], ["startsWith", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-ends-with",
          ["namespace", "strings"],
          ["parameters", ["str", "String"], ["endsWith", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-includes",
          ["namespace", "strings"],
          ["parameters", ["str", "String"], ["includes", "String"]],
          ["return-type", "void"]
        ],
        [
          "define-extern-function",
          "str-test",
          ["namespace", "strings"],
          [
            "parameters",
            ["str", "String"],
            ["regex", "String"],
            ["flags", "String"]
          ],
          ["return-type", "void"]
        ],
        ["export", "string", ["parameters", ["str"]]]
      ]
    ],
    [
      "module",
      "std/index",
      [
        "imports",
        ["std/macros", "***"],
        ["std/memory", "***"],
        ["std/string", "***"]
      ],
      ["exports"],
      [
        [
          "define-function",
          "'<'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "lt_s"], ["left", "right"]]]
        ],
        ["export", "'<'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'>'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "gt_s"], ["left", "right"]]]
        ],
        ["export", "'>'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'<='",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "le_s"], ["left", "right"]]]
        ],
        ["export", "'<='", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'>='",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "ge_s"], ["left", "right"]]]
        ],
        ["export", "'>='", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'=='",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "eq"], ["left", "right"]]]
        ],
        ["export", "'=='", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'and'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "'and'"], ["left", "right"]]]
        ],
        ["export", "'and'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'or'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "'or'"], ["left", "right"]]]
        ],
        ["export", "'or'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'xor'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "'xor'"], ["left", "right"]]]
        ],
        ["export", "'xor'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'not'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "ne"], ["left", "right"]]]
        ],
        ["export", "'not'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'+'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "add"], ["left", "right"]]]
        ],
        ["export", "'+'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'-'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "sub"], ["left", "right"]]]
        ],
        ["export", "'-'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'*'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "mul"], ["left", "right"]]]
        ],
        ["export", "'*'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'/'",
          ["parameters", ["left", "i32"], ["right", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["i32", "div_s"], ["left", "right"]]]
        ],
        ["export", "'/'", ["parameters", ["left", "i32"], ["right", "i32"]]],
        [
          "define-function",
          "'<'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "lt"], ["left", "right"]]]
        ],
        ["export", "'<'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'>'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "gt"], ["left", "right"]]]
        ],
        ["export", "'>'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'<='",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "le"], ["left", "right"]]]
        ],
        ["export", "'<='", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'>='",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "ge"], ["left", "right"]]]
        ],
        ["export", "'>='", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'=='",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "eq"], ["left", "right"]]]
        ],
        ["export", "'=='", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'not'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["binaryen-mod", ["f32", "ne"], ["left", "right"]]]
        ],
        ["export", "'not'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'+'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "f32"],
          ["block", ["binaryen-mod", ["f32", "add"], ["left", "right"]]]
        ],
        ["export", "'+'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'-'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "f32"],
          ["block", ["binaryen-mod", ["f32", "sub"], ["left", "right"]]]
        ],
        ["export", "'-'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'*'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "f32"],
          ["block", ["binaryen-mod", ["f32", "mul"], ["left", "right"]]]
        ],
        ["export", "'*'", ["parameters", ["left", "f32"], ["right", "f32"]]],
        [
          "define-function",
          "'/'",
          ["parameters", ["left", "f32"], ["right", "f32"]],
          ["variables"],
          ["return-type", "f32"],
          ["block", ["binaryen-mod", ["f32", "div"], ["left", "right"]]]
        ],
        ["export", "'/'", ["parameters", ["left", "f32"], ["right", "f32"]]]
      ]
    ],
    [
      "module",
      "src/example",
      ["imports", ["std/index", "***"], ["std/memory", "***"]],
      ["exports"],
      [
        [
          "define-function",
          "fib",
          ["parameters", ["n", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          [
            "block",
            [
              "if",
              ["<", "n", 2],
              "n",
              ["+", ["fib", ["-", "n", 1]], ["fib", ["-", "n", 2]]]
            ]
          ]
        ],
        ["export", "fib", ["parameters", ["n", "i32"]]],
        [
          "define-function",
          "pos",
          ["parameters", ["x", "i32"], ["y", "i32"], ["z", "i32"]],
          ["variables", ["address", "i32"]],
          ["return-type", "i32"],
          [
            "block",
            ["define", ["typed-parameter", "address", "i32"], ["alloc", 12]],
            ["set-x", "address", "x"],
            ["set-y", "address", "y"],
            ["set-z", "address", "z"],
            "address"
          ]
        ],
        [
          "define-function",
          "set-x",
          ["parameters", ["address", "i32"], ["value", "i32"]],
          ["variables"],
          ["return-type", "void"],
          ["block", ["store-i32", "address", 0, "value"]]
        ],
        [
          "define-function",
          "set-y",
          ["parameters", ["address", "i32"], ["value", "i32"]],
          ["variables"],
          ["return-type", "void"],
          ["block", ["store-i32", "address", 4, "value"]]
        ],
        [
          "define-function",
          "set-z",
          ["parameters", ["address", "i32"], ["value", "i32"]],
          ["variables"],
          ["return-type", "void"],
          ["block", ["store-i32", "address", 8, "value"]]
        ],
        [
          "define-function",
          "get-x",
          ["parameters", ["address", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["read-i32", "address", 0]]
        ],
        [
          "define-function",
          "get-y",
          ["parameters", ["address", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["read-i32", "address", 4]]
        ],
        [
          "define-function",
          "get-z",
          ["parameters", ["address", "i32"]],
          ["variables"],
          ["return-type", "i32"],
          ["block", ["read-i32", "address", 8]]
        ],
        [
          "define-function",
          "make-pos",
          ["parameters"],
          [
            "variables",
            ["return-address", "i32"],
            ["pos-a", "i32"],
            ["pos-b", "i32"]
          ],
          ["return-type", "i32"],
          [
            "block",
            [
              "define",
              ["typed-parameter", "return-address", "i32"],
              ["alloc", 12]
            ],
            ["define", ["typed-parameter", "pos-a", "i32"], ["pos", 1, 2, 3]],
            ["define", ["typed-parameter", "pos-b", "i32"], ["pos", 5, 4, 0]],
            ["set-x", "pos-a", ["get-x", "pos-b"]],
            ["copy", "pos-a", "return-address"],
            ["set-return", "return-address"]
          ]
        ],
        [
          "define-function",
          "main",
          ["parameters"],
          ["variables", ["my-pos", "i32"]],
          ["return-type", "i32"],
          [
            "block",
            ["define", ["typed-parameter", "my-pos", "i32"], ["make-pos"]],
            ["get-z", "my-pos"],
            "stack-pointer"
          ]
        ]
      ]
    ]
  ],
  "moduleId": "src/example",
  "path": "/Users/drew/projects/dream/example.dm",
  "srcPath": "/Users/drew/projects/dream",
  "isRoot": true,
  "workingDir": "/Users/drew/projects/dream",
  "imports": [
    [
      {
        "moduleId": "std/index",
        "path": "/Users/drew/projects/dream/std/index.dm",
        "srcPath": "",
        "isRoot": false,
        "workingDir": "/Users/drew/projects/dream/std",
        "imports": [
          [
            {
              "moduleId": "std/macros",
              "path": "/Users/drew/projects/dream/std/macros.dm",
              "srcPath": "",
              "isRoot": false,
              "workingDir": "/Users/drew/projects/dream/std",
              "imports": []
            },
            "***"
          ],
          [
            {
              "moduleId": "std/memory",
              "path": "/Users/drew/projects/dream/std/memory.dm",
              "srcPath": "",
              "isRoot": false,
              "workingDir": "/Users/drew/projects/dream/std",
              "imports": [
                [
                  {
                    "moduleId": "std/macros",
                    "path": "/Users/drew/projects/dream/std/macros.dm",
                    "srcPath": "",
                    "isRoot": false,
                    "workingDir": "/Users/drew/projects/dream/std",
                    "imports": []
                  },
                  "***"
                ]
              ]
            },
            "***"
          ],
          [
            {
              "moduleId": "std/string",
              "path": "/Users/drew/projects/dream/std/string.dm",
              "srcPath": "",
              "isRoot": false,
              "workingDir": "/Users/drew/projects/dream/std",
              "imports": [
                [
                  {
                    "moduleId": "std/macros",
                    "path": "/Users/drew/projects/dream/std/macros.dm",
                    "srcPath": "",
                    "isRoot": false,
                    "workingDir": "/Users/drew/projects/dream/std",
                    "imports": []
                  },
                  "***"
                ]
              ]
            },
            "***"
          ]
        ]
      },
      "***"
    ],
    [
      {
        "moduleId": "std/memory",
        "path": "/Users/drew/projects/dream/std/memory.dm",
        "srcPath": "/Users/drew/projects/dream",
        "isRoot": true,
        "workingDir": "/Users/drew/projects/dream/std",
        "imports": []
      },
      "***"
    ]
  ]
}
